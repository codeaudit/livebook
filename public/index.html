<html>
<head>
  <link href="style.css" rel="stylesheet" type="text/css" />

  <script src="/ace-editor/ace.js"></script>
  <script src="/d3/d3.min.js"></script>
  <script src="/app.js"></script>
</head>
<body>
  <div id="code">
  <div id="editor">
LoadData("activity.csv", function(data) {
    // sum of steps across the same 5-minute time interval each day
    intervals = d3.nest()
      .key(function(d) { return d.interval })
      .rollup(function(d) {
        return d3.sum(d, function(g) { return g.steps })
      }).entries(data);

    // convert key to a number
    intervals = intervals.map(function(x) { x.key = +x.key; return x })

    plot(intervals, "values", "key" )
})
  </div>
  </div>

  <div id="plot"></div>

  <div id="data"></div>

  <script>
    // initialize ace editor
    var editor = ace.edit("editor");
    editor.getSession().setMode("ace/mode/javascript");
    editor.getSession().getSelection().selectionLead.setPosition(2, 0); // cursor at end
    editor.on("change",function() { eval(editor.getValue()); })

    // load data from CSV
    var cache = {}
    function LoadData(name, handler) {
      if (cache[name]) handler(cache[name])
      d3.csv(name, function(error, data) {
        if (error) throw error;
        data.forEach(function(d) {
          d.steps = +d.steps
          d.interval = +d.interval
        });
        cache[name] = data
        tabulate(data, ['steps','date','interval'])
        handler(data)
      });
    }

    eval(editor.getValue())

  </script>

</body>
</html>
